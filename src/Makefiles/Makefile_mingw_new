# This the DDS Makefile for Windows and the MinGW compiler.
# It does assume a Unix-like setup for some commands,
# but if you only want to call "make" with the default target,
# you should be OK.

# If you want to compile a single-threaded version, use
# DDS_THREADS=none

# The "windres" and "cvtres" tools are used for putting version
# information into the DLL in a way that Windows can see.
# It is not mandatory, and if you don't have those tools,
# You can remove $(VFILE).obj in the target line below.


# If your exact compiler name is not given here, change it.
# CC		= mingw32-g++
# CC		= i686-w64-mingw32-g++
CC		= g++

# Use this one to get Windows multi-threading
# CC_FLAGS	= -O3 -flto -mtune=generic
# Use this one to get OpenMP multi-threading
CC_FLAGS	= -O3 -DBUILDING_EXAMPLE_DLL -fopenmp

LD_FLAGS	= 		\
	-Wl,--subsystem,windows \
	-Wl,--output-def,$(DLLBASE).def	\
	-Wl,--dynamicbase 	\
	-Wl,--nxcompat 		\
	-Wl,--no-seh 		\
	-Wl,--enable-stdcall-fixup \
	-lboost_system \
 	-lboost_thread


# These flags are not turned on be default, but DDS should pass them.
# Turn them on below.
WARN_FLAGS	= 		\
	-Wshadow 		\
	-Wsign-conversion 	\
	-pedantic -Wall -Wextra  \
	-Wcast-align -Wcast-qual \
	-Wctor-dtor-privacy 	\
	-Wdisabled-optimization \
	-Winit-self 		\
	-Wlogical-op 		\
	-Wmissing-declarations 	\
	-Wmissing-include-dirs 	\
	-Wnoexcept 		\
	-Wold-style-cast 	\
	-Woverloaded-virtual 	\
	-Wsign-promo 		\
	-Wstrict-null-sentinel 	\
	-Wstrict-overflow=1 	\
	-Wswitch-default -Wundef \
	-Werror 		\
	-Wno-unused 		\
	-Wno-unknown-pragmas 	\
	-Wno-long-long		\
	-Wno-format

# Here you can turn on warnings and add -DSMALL_MEMORY_OPTION
# CC_FULL_FLAGS	= $(CC_FLAGS)
CC_FULL_FLAGS	= $(CC_FLAGS) $(WARN_FLAGS)

LIB_FLAGS	= -shared

DLLBASE		= dds
DLL 		= $(DLLBASE).dll
EXPORTER	= Exports.def

VFILE		= ddsres
WINDRES_FLAG	= -F pe-x86-64

SOURCE_FILES 	=		\
	dds.cpp 		\
	ABsearch.cpp		\
	ABstats.cpp		\
	CalcTables.cpp		\
	DealerPar.cpp 		\
	Init.cpp		\
	LaterTricks.cpp		\
	Moves.cpp		\
	Par.cpp 		\
	PlayAnalyser.cpp	\
	PBN.cpp			\
	QuickTricks.cpp		\
	Scheduler.cpp		\
	SolveBoard.cpp		\
	SolverIF.cpp		\
	System.cpp		\
	Timer.cpp		\
	TransTable.cpp

O_FILES 	= $(subst .cpp,.o,$(SOURCE_FILES)) $(VFILE).o

ifeq ($(DDS_THREADS),none)
DDS_THR		= -DDDS_THREADS_SINGLE
else
DDS_THR		= -DDDS_THREADS_BOOST -DDDS_THREADS_OPENMP -DDDS_THREADS_STL
endif


mingw:	$(O_FILES)
	$(CC) $(LIB_FLAGS) $(O_FILES) -o $(DLL) -lgomp -lboost_system -lboost_thread -Wl,--out-implib,libdds.a -Wl,--no-undefined

%.o:	%.cpp
	$(CC) $(CC_FLAGS) $(DDS_THR) -c $<

$(DLLBASE).res:	$(DLLBASE).rc
	windres $(DLLBASE).rc $(DLLBASE).res

$(VFILE).o:	$(DLLBASE).rc
	windres $(WINDRES_FLAG) $(DLLBASE).rc $(VFILE).o

depend:
	makedepend -Y -- $(CC_FLAGS) -- $(SOURCE_FILES)

clean:
	rm -f $(O_FILES) $(DLL) $(DLLBASE).{lib,def,exp,res}

install:
	test -d ../test || mkdir ../test
	test -d ../examples || mkdir ../examples
	cp $(DLL) $(DLLBASE).def ../test
	cp $(DLL) $(DLLBASE).def ../examples


# DO NOT DELETE

dds.o: ../include/dll.h dds.h debug.h ../include/portab.h TransTable.h
dds.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
dds.o: TimeStatList.h TimeStat.h Init.h
ABsearch.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
ABsearch.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
ABsearch.o: TimeStatList.h TimeStat.h threadmem.h QuickTricks.h LaterTricks.h
ABsearch.o: ABsearch.h
ABstats.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
ABstats.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
ABstats.o: TimeStatList.h TimeStat.h
CalcTables.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
CalcTables.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
CalcTables.o: TimeStatList.h TimeStat.h SolveBoard.h PBN.h
DealerPar.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
DealerPar.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
DealerPar.o: TimeStatList.h TimeStat.h
Init.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
Init.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
Init.o: TimeStatList.h TimeStat.h threadmem.h Init.h ABsearch.h System.h
LaterTricks.o: dds.h debug.h ../include/portab.h TransTable.h
LaterTricks.o: ../include/dll.h TimerList.h TimerGroup.h Timer.h ABstats.h
LaterTricks.o: Moves.h Scheduler.h TimeStatList.h TimeStat.h threadmem.h
LaterTricks.o: LaterTricks.h
Moves.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
Moves.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
Moves.o: TimeStatList.h TimeStat.h ABsearch.h
Par.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
Par.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
Par.o: TimeStatList.h TimeStat.h
PlayAnalyser.o: dds.h debug.h ../include/portab.h TransTable.h
PlayAnalyser.o: ../include/dll.h TimerList.h TimerGroup.h Timer.h ABstats.h
PlayAnalyser.o: Moves.h Scheduler.h TimeStatList.h TimeStat.h threadmem.h
PlayAnalyser.o: SolverIF.h System.h PBN.h
PBN.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
PBN.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
PBN.o: TimeStatList.h TimeStat.h PBN.h
QuickTricks.o: dds.h debug.h ../include/portab.h TransTable.h
QuickTricks.o: ../include/dll.h TimerList.h TimerGroup.h Timer.h ABstats.h
QuickTricks.o: Moves.h Scheduler.h TimeStatList.h TimeStat.h threadmem.h
QuickTricks.o: QuickTricks.h
Scheduler.o: Scheduler.h TimeStatList.h TimeStat.h dds.h debug.h
Scheduler.o: ../include/portab.h TransTable.h ../include/dll.h TimerList.h
Scheduler.o: TimerGroup.h Timer.h ABstats.h Moves.h
SolveBoard.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
SolveBoard.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
SolveBoard.o: TimeStatList.h TimeStat.h threadmem.h SolverIF.h SolveBoard.h
SolveBoard.o: System.h PBN.h
SolverIF.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
SolverIF.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
SolverIF.o: TimeStatList.h TimeStat.h Init.h threadmem.h ABsearch.h
SolverIF.o: SolverIF.h
System.o: ../include/dll.h dds.h debug.h ../include/portab.h TransTable.h
System.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
System.o: TimeStatList.h TimeStat.h System.h SolveBoard.h PlayAnalyser.h
Timer.o: Timer.h ../include/portab.h
TransTable.o: dds.h debug.h ../include/portab.h TransTable.h ../include/dll.h
TransTable.o: TimerList.h TimerGroup.h Timer.h ABstats.h Moves.h Scheduler.h
TransTable.o: TimeStatList.h TimeStat.h
